---
title: "Analysis Reinforcement Results"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F,
                      message = F,
                      warning = F)
```
```{r}
library(tidyverse)
library(glue)
```


```{r}
LOGS_DIR = '../src'
DATA_DIR = '../data'
```


```{r}
load <- function(filename) {
  return(
    read_csv(filename) %>%
      mutate(action=as.factor(action)) %>%
      mutate(net_worth = balance + asset_balance * price) %>%
      mutate(step = X1) %>%
      select(-X1) %>%
      filter(price > 0)
  )
}
```






```{r}
vis.df = function(df) {
  df %>%
    gather(-step, -action, key = "feature", value = "value") %>%
    ggplot(aes(x = step, y = value)) +
    geom_line() +
    facet_wrap( ~ feature, scales = 'free')
}
```


```{r}
train.df <- load(glue('{LOGS_DIR}/train.csv'))
```

```{r fig.height=10, fig.width=20}
vis.df(train.df)
```

```{r}
train.df %>%
  ggplot(aes(x=step, y=net_worth)) +
           geom_line() +
  scale_x_continuous(limit=c(150000,200000))
```



```{r}
test.df <- load(glue('{LOGS_DIR}/test.csv'))
```


```{r fig.height=10, fig.width=20}
vis.df(test.df)
```

```{r}
test.df %>%
  ggplot(aes(x=step, y=price)) +
  geom_line()
```

```{r}
test.df %>% 
  group_by(action) %>%
  summarise(n=n())
  
```

```{r}
test.df %>% filter(reward==0)
```

